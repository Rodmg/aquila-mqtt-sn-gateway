{"version":3,"sources":["../src/models/Topic.ts"],"names":[],"mappings":";;AAAA,uCAAuC;AACvC,gCAA6B;AAC7B,qCAAkC;AAClC,iDAA8C;AAC9C,uCAAoC;AAEvB,QAAA,KAAK,GAAG,OAAE,CAAC,MAAM,CAAC,OAAO,EAAE;IACtC,EAAE,EAAE;QACF,IAAI,EAAE,SAAS,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,QAAQ;QACpC,SAAS,EAAE,KAAK;QAChB,UAAU,EAAE,IAAI;QAChB,aAAa,EAAE,IAAI;KACpB;IACD,IAAI,EAAE;QACJ,IAAI,EAAE,SAAS,CAAC,MAAM;QACtB,SAAS,EAAE,KAAK;KACjB;IACD,IAAI,EAAE;QACJ,IAAI,EAAE,SAAS,CAAC,IAAI,CAAC,YAAY,EAAE,QAAQ,EAAE,aAAa,CAAC;QAC3D,SAAS,EAAE,KAAK;QAChB,YAAY,EAAE,QAAQ;KACvB;CACF,EAAE;IACD,YAAY,EAAE;QACZ,eAAe,EAAE;YACf,MAAM,CAAC;gBACL,MAAM,EAAE;oBACN,IAAI,EAAE,WAAW;oBACjB,KAAK,EAAE,eAAM;oBACb,EAAE,EAAE,QAAQ;oBACZ,KAAK,EAAE,IAAI;iBACZ;gBACD,aAAa,EAAE;oBACb,IAAI,EAAE,SAAS;oBACf,KAAK,EAAE,2BAAY;oBACnB,EAAE,EAAE,eAAe;oBACnB,WAAW,EAAE,KAAK;iBACnB;gBACD,QAAQ,EAAE;oBACR,IAAI,EAAE,SAAS;oBACf,KAAK,EAAE,iBAAO;oBACd,EAAE,EAAE,UAAU;oBACd,WAAW,EAAE,KAAK;iBACnB;aACF,CAAA;QACH,CAAC;KACF;IACD,eAAe,EAAE,EAChB;IACD,KAAK,EAAE;QACL,gBAAgB,CAAC,KAAiB,EAAE,OAAY,EAAE,EAAY;YAC5D,OAAO,CAAC,eAAe,GAAG,IAAI,CAAC;YAC/B,EAAE,EAAE,CAAC;QACP,CAAC;QACD,iBAAiB,CAAC,OAAY,EAAE,EAAY;YAC1C,OAAO,CAAC,eAAe,GAAG,IAAI,CAAC;YAC/B,EAAE,EAAE,CAAC;QACP,CAAC;QACD,aAAa,EAAE,UAAS,KAAU;YAChC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC;gBACf,2BAAY,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,EAAE,OAAO,EAAE,KAAK,CAAC,EAAE,EAAE,EAAE,CAAC;gBACtD,iBAAO,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,EAAE,OAAO,EAAE,KAAK,CAAC,EAAE,EAAE,EAAE,CAAC;aAClD,CAAC,CAAC;QACP,CAAC;KACF;CACF,CAAC,CAAC","file":"Topic.js","sourcesContent":["import * as DataTypes from 'sequelize';\nimport { db } from './../db';\nimport { Device } from './Device';\nimport { Subscription } from './Subscription';\nimport { Message } from './Message';\n\nexport const Topic = db.define('topic', {\n  id: {\n    type: DataTypes.INTEGER(10).UNSIGNED,\n    allowNull: false,\n    primaryKey: true,\n    autoIncrement: true\n  },\n  name: {\n    type: DataTypes.STRING,\n    allowNull: false\n  },\n  type: {\n    type: DataTypes.ENUM('short name', 'normal', 'pre-defined'),\n    allowNull: false,\n    defaultValue: 'normal'\n  }\n}, {\n  classMethods: {\n    getAssociations: () => {\n      return {     \n        device: {\n          type: 'belongsTo',\n          model: Device,\n          as: 'device',\n          hooks: true\n        },\n        subscriptions: {\n          type: 'hasMany',\n          model: Subscription,\n          as: 'subscriptions',\n          constraints: false\n        },\n        messages: {\n          type: 'hasMany',\n          model: Message,\n          as: 'messages',\n          constraints: false\n        }\n      }\n    }\n  },\n  instanceMethods: {\n  },\n  hooks: {\n    beforeBulkCreate(items: Array<any>, options: any, fn: Function) {\n      options.individualHooks = true;\n      fn();\n    },\n    beforeBulkDestroy(options: any, fn: Function) {\n      options.individualHooks = true;\n      fn();\n    },\n    beforeDestroy: function(topic: any) {\n      return Promise.all([\n          Subscription.destroy({ where: { topicId: topic.id } }),\n          Message.destroy({ where: { topicId: topic.id } })\n        ]);\n    }\n  }\n});"],"sourceRoot":"/Users/rod/workshop/aquila-gateway/src"}